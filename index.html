<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>words2digits: words2digits</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">words2digits
   &#160;<span id="projectnumber">0.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">words2digits </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>C++11 pet project to convert textual numbers from words to digits.</p>
<p>Fundamentally, the textual numbers are those recognized by the following context-free grammar:</p>
<div class="fragment"><div class="line">CardNum      -&gt; <span class="stringliteral">&#39;zero&#39;</span> | Millions | AValue</div>
<div class="line"> </div>
<div class="line">Digit        -&gt; <span class="stringliteral">&#39;one&#39;</span> | <span class="stringliteral">&#39;two&#39;</span> | <span class="stringliteral">&#39;three&#39;</span> | <span class="stringliteral">&#39;four&#39;</span> | <span class="stringliteral">&#39;five&#39;</span> |</div>
<div class="line">                <span class="stringliteral">&#39;six&#39;</span> | <span class="stringliteral">&#39;seven&#39;</span> | <span class="stringliteral">&#39;eight&#39;</span> | <span class="stringliteral">&#39;nine&#39;</span></div>
<div class="line">Teens        -&gt; <span class="stringliteral">&#39;ten&#39;</span> | <span class="stringliteral">&#39;eleven&#39;</span> | <span class="stringliteral">&#39;twelve&#39;</span>  | <span class="stringliteral">&#39;thirteen&#39;</span> |</div>
<div class="line">                <span class="stringliteral">&#39;fourteen&#39;</span> | <span class="stringliteral">&#39;fifteen&#39;</span> | <span class="stringliteral">&#39;sixteen&#39;</span> |</div>
<div class="line">                <span class="stringliteral">&#39;seventeen&#39;</span> | <span class="stringliteral">&#39;eighteen&#39;</span> | <span class="stringliteral">&#39;nineteen&#39;</span></div>
<div class="line">SecDig       -&gt; <span class="stringliteral">&#39;twenty&#39;</span> | <span class="stringliteral">&#39;thirty&#39;</span> | <span class="stringliteral">&#39;forty&#39;</span> | <span class="stringliteral">&#39;fifty&#39;</span> |</div>
<div class="line">                <span class="stringliteral">&#39;sixty&#39;</span> | <span class="stringliteral">&#39;seventy&#39;</span> | <span class="stringliteral">&#39;eighty&#39;</span> |</div>
<div class="line">                <span class="stringliteral">&#39;ninety&#39;</span></div>
<div class="line">Below100     -&gt; Digit | Teens | SecDig | SecDig <span class="charliteral">&#39;-&#39;</span> Digit</div>
<div class="line"> </div>
<div class="line">HundredSfx   -&gt; <span class="stringliteral">&#39;hundred&#39;</span> | <span class="stringliteral">&#39;hundred and &#39;</span> Below100</div>
<div class="line">Hundreds     -&gt; Below100 | Digit <span class="charliteral">&#39; &#39;</span> HundredSfx</div>
<div class="line"> </div>
<div class="line">ThousandSfx  -&gt; <span class="stringliteral">&#39;thousand&#39;</span> | <span class="stringliteral">&#39;thousand &#39;</span> Hundreds</div>
<div class="line">Thousands    -&gt; Hundreds | Hundreds <span class="charliteral">&#39; &#39;</span> ThousandSfx</div>
<div class="line"> </div>
<div class="line">MillionSfx   -&gt; <span class="stringliteral">&#39;million&#39;</span> | <span class="stringliteral">&#39;million &#39;</span> Thousands</div>
<div class="line">Millions     -&gt; Thousands | Thousands <span class="charliteral">&#39; &#39;</span> MillionSfx</div>
<div class="line"> </div>
<div class="line">AValue       -&gt; <span class="stringliteral">&#39;a &#39;</span> HundredSfx |</div>
<div class="line">                <span class="stringliteral">&#39;a &#39;</span> ThousandSfx | <span class="stringliteral">&#39;a hundred &#39;</span> ThousandSfx |</div>
<div class="line">                <span class="stringliteral">&#39;a &#39;</span> MillionSfx  | <span class="stringliteral">&#39;a hundred &#39;</span> MillionSfx</div>
</div><!-- fragment --><p>Which recognizes words such as </p><div class="fragment"><div class="line">zero</div>
<div class="line">one</div>
<div class="line">three hundred and forty-one</div>
<div class="line">one thousand four hundred and eighty-seven</div>
<div class="line">eight thousand six hundred and sixty-eight</div>
<div class="line">three hundred and seventy-one thousand two hundred and seventeen</div>
<div class="line">two million six hundred and sixty-two thousand five hundred and two</div>
<div class="line">a hundred and one</div>
<div class="line">a hundred and fifty-nine</div>
<div class="line">a thousand three hundred and eighty-five</div>
<div class="line">a million three hundred and ninety-two</div>
</div><!-- fragment --><p>Those are textual representation of cardinal numbers up to the millions. However, support for higher-order numbers (billions, trillions, ...) is trivial as they follow the same pattern as millions. Under <code>tools/</code> there is a Python script that generates such samples from the grammar using the <code>nltk</code> package.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
How to build</h1>
<p>To build, use the typical CMake workflow</p>
<div class="fragment"><div class="line">mkdir build &amp;&amp; cd build</div>
<div class="line">cmake ..</div>
<div class="line"># ninja, make, ...</div>
</div><!-- fragment --><p>The following cache variables are added </p><div class="fragment"><div class="line">VARIABLE        DEFAULT     EXPLANATION</div>
<div class="line">W2D_BUILD_DOC   ON          whether to build the Doxygen docs, fails</div>
<div class="line">                            gracefuly if Doxygen is not found</div>
<div class="line">W2D_TESTS       OFF         whether to build the test files, requires GTest</div>
<div class="line">                            submodule initialized</div>
<div class="line">W2D_COVERAGE    OFF         whether to instrument unittest for coverage, only</div>
<div class="line">                            affects when compiling with gcc (requires gcov)</div>
</div><!-- fragment --><p>For the tests, this project uses <a href="https://github.com/google/googletest">GTest</a>, which is present as a Git submodule. Just invoke </p><div class="fragment"><div class="line">git submodule init</div>
<div class="line">git submodule update extern/googletest</div>
</div><!-- fragment --><p>Note that depending on the <code>CMakeCache.txt</code> configuration, it may be needed that GTest is forced to be dynamically linked with the C/C++ runtimes. This can be controlled by the <code>gtest_force_shared_crt</code> cache variable, either by invoking </p><div class="fragment"><div class="line">cmake .. -Dgtest_force_shared_crt=ON</div>
</div><!-- fragment --><p>or modifying the generated <code>CMakeCache.txt</code> file directly.</p>
<p>To execute, just invoke <code>words2digits</code> with either an input file or using the standard in. Under <code>samples/</code> there is the following example</p>
<div class="fragment"><div class="line">Name a number: forty-two.</div>
<div class="line">She thought —a hundred sheep after— I am not getting any sleep.</div>
<div class="line">A thousand words are worth less than a picture, but even a</div>
<div class="line"> hundred well-said words will get you far enough.</div>
<div class="line">Zero times one million thirty-three thousand nine hundred and seven dot six is still zero.</div>
<div class="line">The words of general 栗林 were clear, we were to attack on the fourth day with</div>
<div class="line">a hundred thousand-man troop.</div>
<div class="line">One hundred and two thousand may be ambiguous, is it a hundred thousand plus two thousand</div>
<div class="line">or one hundred and then two thousand?</div>
<div class="line">Left associative greediness produce some effect:</div>
<div class="line">    &quot;a hundred and two thousand forty-two&quot; versus &quot;a hundred, and two thousand forty-two&quot;.</div>
<div class="line">a thousand eight hundred and eighty-three</div>
<div class="line">a hundred and fifty-four</div>
<div class="line">a hundred thousand five hundred and sixteen</div>
<div class="line">a million   ninety thousand   seven hundred   and eighty-one</div>
<div class="line">a hundred million four hundred and six thousand eight hundred and fifty-seven</div>
<div class="line">A</div>
<div class="line">hundred</div>
<div class="line">and</div>
<div class="line">two.</div>
</div><!-- fragment --><p>which the tool transforms it to</p>
<div class="fragment"><div class="line">Name a number: 42.</div>
<div class="line">She thought —100 sheep after— I am not getting any sleep.</div>
<div class="line">1000 words are worth less than a picture, but even</div>
<div class="line">100 well-said words will get you far enough.</div>
<div class="line">0 times 1033907 dot 6 is still 0.</div>
<div class="line">The words of general 栗林 were clear, we were to attack on the fourth day with</div>
<div class="line">100000-man troop.</div>
<div class="line">102000 may be ambiguous, is it 100000 plus 2000</div>
<div class="line">or 100 and then 2000?</div>
<div class="line">Left associative greediness produce some effect:</div>
<div class="line">    &quot;102 thousand 42&quot; versus &quot;100, and 2042&quot;.</div>
<div class="line">1883</div>
<div class="line">154</div>
<div class="line">100516</div>
<div class="line">1090781</div>
<div class="line">100406857</div>
<div class="line"> </div>
<div class="line">102.</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md2"></a>
Program architecture</h1>
<p>The program is split into two main components, a tokenizer and a grammar parser. As the parsed grammar is an LL(k) grammar, a straight-forward recursive descent parser has been implemented. This means that, at a high level, this parser only requires that, given a specific token, which is the next token in the stream.</p>
<p>As some of the text must be replaced when processed, the tokenizer performs three basic roles:</p><ul>
<li>Splits the input text into tokens of different categories (text, spaces and other).</li>
<li>Stores the processed tokens in a transient state in which they might be modified (replaced).</li>
<li>Dumps the tokens in the same order that they were read from the transient state to an output stream of characters.</li>
</ul>
<p>For more details see the code <a href="https://daduraro.github.io/words2digits/">documentation</a>.</p>
<h1><a class="anchor" id="autotoc_md3"></a>
Documentation</h1>
<p>There are two kind of generated reports:</p>
<ul>
<li><a href="https://daduraro.github.io/words2digits/">Doxygen generated documentation</a>, that can be built from sources directly from a CMake target.</li>
<li><a href="https://daduraro.github.io/words2digits/coverage/">gcovr test coverage report</a>, that can be generated, after executing the instrumented unittest (see <a href="#how-to-build">How to build</a>), using the command:</li>
</ul>
<div class="fragment"><div class="line">gcovr -r source/cli/ -e &#39;.*test.*&#39; build/  --html --html-details -o coverage/index.html</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md4"></a>
Limitations</h1>
<h2><a class="anchor" id="autotoc_md5"></a>
a) Other textual number representations</h2>
<p>Language is hard, and it needs context. Any approach to be accurate on the text interpretation based on context-free grammars will unavoidably fail in some cases. For example, texts that refer to dates as "nineteen ninety-two" need context in order to understand they are not two disconnected numbers, "19" and "92", but they rather refer to a single date number: "1992".</p>
<p>Moreover, the current CFG already skips some number representations such as "nil" or "oh" representing 0, and only deals with cardinal numbers up to the millions (although support for billions, trillions, etc. is trivial), being oblivious to fractional numbers, ordinal numbers, etc.</p>
<h2><a class="anchor" id="autotoc_md6"></a>
b) Text encoding</h2>
<p>Currently, only UTF-8 / ASCII encodings are supported. See Unicode support limitation.</p>
<h2><a class="anchor" id="autotoc_md7"></a>
c) Unicode support</h2>
<p>As all the symbols of the current grammar can be represented as single ASCII/UTF-8 bytes, this first version makes some assumptions on the tokenization. This has the unfortunate effect that multi-byte code points are incorrectly classified as "other", regardless of their actual classification. Regrettably, in a lot of places in the C++ Standard Library it is assumed a single character represent a single code point (see the classification functions in <a href="https://en.cppreference.com/w/cpp/header/locale">&lt;locale&gt;</a>), which is false for variable-length encodings such as UTF-8 or UTF-16. Adding support for languages whose textual numbers representations are not formed by single-byte code points of UTF-8 would require moving the internal character representations to <code>char16_t</code> or <code>char32_t</code>, or even using some specialized libraries such as <a href="http://site.icu-project.org/">ICU</a>.</p>
<h2><a class="anchor" id="autotoc_md8"></a>
d) CRLF / LF from original file is not preserved</h2>
<p>As the application might need to write a newline when a textual number spans multiple line, I made the decision to open files in textual format (which do CRLF/LF conversion) for simplicity and to avoid having inconsistent newline symbols. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
